{"body": "Author: antelder\nDate: Sat Jul 10 07:20:24 2010\nNew Revision: 962777\n\nURL: http://svn.apache.org/viewvc?rev=962777&view=rev\nLog:\nAdd the 1.1 release info\n\nModified:\n    abdera/site/trunk/index.html\n\nModified: abdera/site/trunk/index.html\nURL: http://svn.apache.org/viewvc/abdera/site/trunk/index.html?rev=962777&r1=962776&r2=962777&view=diff\n==============================================================================\n--- abdera/site/trunk/index.html (original)\n+++ abdera/site/trunk/index.html Sat Jul 10 07:20:24 2010\n@@ -51,6 +51,8 @@\n     <h2>News</h2>\n \n     <dl>\n+      <dt>July 10, 2010: Abdera 1.1 <a href=\"#abdera.1.1\">Released</a></dt>\n+      <dd>Abdera 1.1 has been relelased containg many bug fixes.</dd>\n       <dt>May 2, 2010: Abdera 1.0 <a href=\"#abdera.1.0\">Released</a></dt>\n       <dd>The 1.0 release of Abdera created in January 2009 has now been published.</dd>\n       <dt>November 25, 2008: Abdera graduates from the Apache Incubator</dt>\n@@ -142,6 +144,46 @@\n     \n     <h2>Downloads</h2>\n     \n+    <a id=\"abdera.1.1\"></a>\n+    <table width=\"100%\">\n+    <caption><b>Abdera 1.1</b></caption>\n+    <tr>\n+    <th>Description</th>\n+    <th>Location</th>\n+    <th>MD5 Checksum</th>\n+    </tr>\n+    <tr>\n+    <td align=\"center\" rowspan=\"2\">Abdera 1.1</td>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1.tar.gz\">apache-abdera-1.1.tar.gz</a></td>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1.tar.gz.md5\">c713fa3aaa586610b089bdf064ab5512</a></td>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1.tar.gz.asc\">(Signature)</a></td>\n+    </tr>\n+    <tr>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1.zip\">apache-abdera-1.1.zip</a></td>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1.zip.md5\">784e9ed91fd3162bdfdf72f205a68b8a</a></td>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1.zip.asc\">(Signature)</a></td>\n+    </tr>\n+\n+    <tr>\n+    <td align=\"center\" rowspan=\"2\">Abdera 1.0 Source</td>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1-src.tar.gz\">apache-abdera-1.1-src.tar.gz</a></td>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1-src.tar.gz.md5\">0fef3dfed031be664e089f9cae4a553d</a></td>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1-src.tar.gz.asc\">(Signature)</a></td>\n+    </tr>\n+    <tr>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1-src.zip\">apache-abdera-1.1-src.zip</a></td>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1-src.zip.md5\">01ba162d5ef486924be6d68c71ea5fa1</a></td>\n+    <td align=\"center\"><a href=\"http://www.apache.org/dist/abdera/1.1/apache-abdera-1.1-src.zip.asc\">(Signature)</a></td>\n+    </tr>\n+    \n+    <tr>\n+    <td colspan=\"4\" style=\"text-align:right\"><a href=\"http://svn.apache.org/repos/asf/incubator/abdera/java/tags/abdera-1.1/KEYS\">Release signing key</a></td>\n+    </tr>\n+    \n+    </table>\n+     \n+    <br />\n+\n     <a id=\"abdera.1.0\"></a>\n     <table width=\"100%\">\n     <caption><b>Abdera 1.0</b></caption>\n\n\n", "message_to": "commits@abdera.apache.org", "message_from": "antelder@apache.org", "references": null, "message_uuid": "1ccfb45a5e1c11e3a468fa163e1e9c80", "list_id": "commits.abdera.apache.org", "date": "Sat, 10 Jul 2010 07:20:25 -0000", "in_reply_to": null, "message_id": "20100710072025.114B023889E5@eris.apache.org", "subject": "svn commit: r962777 - /abdera/site/trunk/index.html"}
{"body": "Author: rooneg\nDate: Mon Oct  2 08:11:55 2006\nNew Revision: 452065\n\nURL: http://svn.apache.org/viewvc?view=rev&rev=452065\nLog:\nMake the ChangeControlParser work on 1.4 JVMs.\n\nSubmitted by: Steven Isaacson <spisaacs gmail.com>\n\n[ in protocol/src/main/java/org/apache/abdera/protocol/util ]\n\n* CacheControlParser.java\n  (select): Use String.replaceAll, not String.replace, since replaceAll\n   exists in Java 1.4.\n\nModified:\n    incubator/abdera/java/trunk/protocol/src/main/java/org/apache/abdera/protocol/util/CacheControlParser.java\n\nModified: incubator/abdera/java/trunk/protocol/src/main/java/org/apache/abdera/protocol/util/CacheControlParser.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/protocol/src/main/java/org/apache/abdera/protocol/util/CacheControlParser.java?view=diff&rev=452065&r1=452064&r2=452065\n==============================================================================\n--- incubator/abdera/java/trunk/protocol/src/main/java/org/apache/abdera/protocol/util/CacheControlParser.java (original)\n+++ incubator/abdera/java/trunk/protocol/src/main/java/org/apache/abdera/protocol/util/CacheControlParser.java Mon Oct  2 08:11:55 2006\n@@ -31,7 +31,7 @@\n     \n     public static Directive select(String d) {\n       try {\n-        d = d.toUpperCase().replace(\"-\", \"\");\n+        d = d.toUpperCase().replaceAll(\"-\", \"\");\n         return Directive.valueOf(d);\n       } catch (Exception e) {}\n       return UNKNOWN;\n\n\n", "message_to": "abdera-commits@incubator.apache.org", "message_from": "rooneg@apache.org", "references": null, "message_uuid": "1cd967985e1c11e3a468fa163e1e9c80", "list_id": "abdera-commits.incubator.apache.org", "date": "Mon, 02 Oct 2006 15:11:56 -0000", "in_reply_to": null, "message_id": "20061002151156.6FF571A981D@eris.apache.org", "subject": "svn commit: r452065 -\n /incubator/abdera/java/trunk/protocol/src/main/java/org/apache/abdera/protocol/util/CacheControlParser.java"}
{"body": "Author: jmsnell\nDate: Mon Oct  2 08:43:36 2006\nNew Revision: 452084\n\nURL: http://svn.apache.org/viewvc?view=rev&rev=452084\nLog:\nExplicitly set the charset \n\nModified:\n    incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestBase.java\n\nModified: incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestBase.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestBase.java?view=diff&rev=452084&r1=452083&r2=452084\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestBase.java (original)\n+++ incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestBase.java Mon Oct  2 08:43:36 2006\n@@ -25,7 +25,7 @@\n     try {\n       byte[] b = new byte[chars.length];\n       for (int n = 0; n < chars.length; n++) b[n] = (byte)chars[n];\n-      return new String(b);\n+      return new String(b,\"utf-8\");\n     } catch (Exception e ) {\n       e.printStackTrace();\n     }\n\n\n", "message_to": "abdera-commits@incubator.apache.org", "message_from": "jmsnell@apache.org", "references": null, "message_uuid": "1cd987d25e1c11e3a468fa163e1e9c80", "list_id": "abdera-commits.incubator.apache.org", "date": "Mon, 02 Oct 2006 15:43:36 -0000", "in_reply_to": null, "message_id": "20061002154336.AF72D1A981D@eris.apache.org", "subject": "svn commit: r452084 -\n /incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestBase.java"}
{"body": "Author: jmsnell\nDate: Mon Oct  2 14:44:56 2006\nNew Revision: 452232\n\nURL: http://svn.apache.org/viewvc?view=rev&rev=452232\nLog:\nSilly bug\n\nModified:\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/RewindableInputStream.java\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/RewindableInputStream.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/RewindableInputStream.java?view=diff&rev=452232&r1=452231&r2=452232\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/RewindableInputStream.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/RewindableInputStream.java Mon Oct  2 14:44:56 2006\n@@ -44,6 +44,10 @@\n     this.scale = capacity;\n   }\n \n+  public int position() {\n+    return position;\n+  }\n+  \n   private void grow(int capacity)  {\n     if (buffer == null) {\n       buffer = new byte[capacity];\n@@ -95,7 +99,8 @@\n     int r = super.read(b, off, len);\n     if (r != -1) {\n       if (position + r >= buffer.length) grow(Math.max(position+r,scale));\n-      System.arraycopy(b, off, buffer, position++, r);\n+      System.arraycopy(b, off, buffer, position, r);\n+      position = position + r;\n     }\n     return r;\n   }\n\n\n", "message_to": "abdera-commits@incubator.apache.org", "message_from": "jmsnell@apache.org", "references": null, "message_uuid": "1cd9df205e1c11e3a468fa163e1e9c80", "list_id": "abdera-commits.incubator.apache.org", "date": "Mon, 02 Oct 2006 21:44:57 -0000", "in_reply_to": null, "message_id": "20061002214457.412011A981A@eris.apache.org", "subject": "svn commit: r452232 -\n /incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/RewindableInputStream.java"}
{"body": "Author: jmsnell\nDate: Tue Oct  3 11:22:11 2006\nNew Revision: 452589\n\nURL: http://svn.apache.org/viewvc?view=rev&rev=452589\nLog:\nResolution for http://issues.apache.org/jira/browse/ABDERA-9\n\nThis is largely a patch up.  We will need to revisit this (and the IRI parsing code in general) to ensure\nthat it can work with as broad a range of IRI/URI schemes as possible.\n\nModified:\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Constants.java\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/HttpScheme.java\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Constants.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Constants.java?view=diff&rev=452589&r1=452588&r2=452589\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Constants.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Constants.java Tue Oct  3 11:22:11 2006\n@@ -108,7 +108,10 @@\n   \n   public final static BitSet IREGNAME   = new ChainableBitSet().set2(IUNRESERVED)\n                                             .set2(ESCAPED)\n-                                            .set2(\"$,;:@&=+\");\n+                                            .set2(\"!$&'()*+,;=\");\n+  public final static BitSet REGNAME    = new ChainableBitSet().set2(UNRESERVED)\n+                                            .set2(ESCAPED)\n+                                            .set2(\"!$&'()*+,;=\");\n   \n   public final static BitSet IUSERINFO  = new ChainableBitSet().set2(IUNRESERVED)\n                                             .set2(ESCAPED)\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/HttpScheme.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/HttpScheme.java?view=diff&rev=452589&r1=452588&r2=452589\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/HttpScheme.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/HttpScheme.java Tue Oct  3 11:22:11 2006\n@@ -79,12 +79,11 @@\n         ui,\n         host,\n         port,\n-        IRI.normalize(iri.getPath()),\n+        IRI.normalize(this,iri.getPath()),\n         iri.getQuery(),\n         iri.getFragment(),\n         iri.doubleslash\n       );\n   }\n-  \n   \n }\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java?view=diff&rev=452589&r1=452588&r2=452589\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java Tue Oct  3 11:22:11 2006\n@@ -194,7 +194,7 @@\n \n     a_host = IDNA.toASCII(d_host);\n     a_fragment = Escaping.encode(getFragment(),Constants.FRAGMENT);\n-    a_path = normalize(Escaping.encode(getPath(), Constants.PATH));\n+    a_path = normalize(_scheme,Escaping.encode(getPath(), Constants.PATH));\n     a_query = Escaping.encode(getQuery(),Constants.QUERY);\n     a_userinfo = Escaping.encode(getUserInfo(),Constants.USERINFO);\n     a_authority = buildASCIIAuthority();\n@@ -368,12 +368,16 @@\n   }\n   \n   private String buildASCIIAuthority() {\n-    StringBuffer buf = new StringBuffer();\n-    String aui = getASCIIUserInfo();\n-    String ah = getASCIIHost();\n-    int port = getPort();\n-    buildAuthority(buf,aui,ah,port);\n-    return buf.toString();\n+    if (_scheme instanceof HttpScheme) {\n+      StringBuffer buf = new StringBuffer();\n+      String aui = getASCIIUserInfo();\n+      String ah = getASCIIHost();\n+      int port = getPort();\n+      buildAuthority(buf,aui,ah,port);\n+      return buf.toString();\n+    } else {\n+      return Escaping.encode(getAuthority(), Constants.USERINFO, Constants.REGNAME);\n+    }\n   }\n   \n   public String getASCIIAuthority() {\n@@ -444,8 +448,8 @@\n         (b.scheme != null && c.scheme == null) ||\n         (b.scheme != null && c.scheme != null && \n           !b.scheme.equalsIgnoreCase(c.scheme))) return c;\n-    String bpath = normalize(b.getPath());\n-    String cpath = normalize(c.getPath());\n+    String bpath = normalize(b._scheme,b.getPath());\n+    String cpath = normalize(c._scheme,c.getPath());\n     bpath = (bpath != null) ? bpath : \"/\";\n     cpath = (cpath != null) ? cpath : \"/\";\n     if (!bpath.equals(cpath)) {\n@@ -455,7 +459,7 @@\n     IRI iri = new IRI(\n       null,\n       null,null,null,null,-1,\n-      normalize(cpath.substring(bpath.length())), \n+      normalize(b._scheme,cpath.substring(bpath.length())), \n       c.getQuery(), \n       c.getFragment(), \n       false);\n@@ -504,7 +508,7 @@\n           b.getUserInfo(),\n           b.getHost(),\n           b.getPort(),\n-          normalize(b.getPath()),\n+          normalize(b._scheme,b.getPath()),\n           b.getQuery(),\n           cfragment,\n           b.doubleslash\n@@ -529,14 +533,14 @@\n       host = b.getHost();\n       port = b.getPort();\n       path = c.isPathAbsolute() ? \n-          normalize(c.getPath()) : \n+          normalize(b._scheme,c.getPath()) : \n           resolve(b.getPath(),c.getPath());\n     } else {\n       authority = c.getAuthority();\n       userinfo = c.getUserInfo();\n       host = c.getHost();\n       port = c.getPort();\n-      path = normalize(c.getPath());\n+      path = normalize(b._scheme,c.getPath());\n     }\n     return new IRI(_scheme,scheme,authority,userinfo,host,port,path,query,fragment,ds);\n   }\n@@ -558,14 +562,15 @@\n         iri.getUserInfo(),\n         iri.getHost(),\n         iri.getPort(),\n-        normalize(iri.getPath()),\n+        normalize(iri._scheme,iri.getPath()),\n         iri.getQuery(),\n         iri.getFragment(),\n         iri.doubleslash\n       );\n   }\n \n-  static String normalize(String path) {\n+  static String normalize(Scheme scheme, String path) {\n+    if (scheme != null && !(scheme instanceof HttpScheme)) return path;\n     if (path == null) return \"/\";\n     String[] segments = path.split(\"/\");\n     if (segments.length < 2) return path;\n@@ -604,7 +609,7 @@\n     int n = bpath.lastIndexOf('/');\n     if (n > -1) buf.append(bpath.substring(0,n+1));\n     if (cpath.length() != 0) buf.append(cpath);\n-    return normalize(buf.toString());\n+    return normalize(new HttpScheme(),buf.toString());\n   }\n   \n   public IRI resolve(IRI iri) {\n\n\n", "message_to": "abdera-commits@incubator.apache.org", "message_from": "jmsnell@apache.org", "references": null, "message_uuid": "1cd9f53c5e1c11e3a468fa163e1e9c80", "list_id": "abdera-commits.incubator.apache.org", "date": "Tue, 03 Oct 2006 18:22:11 -0000", "in_reply_to": null, "message_id": "20061003182212.2E1C11A981A@eris.apache.org", "subject": "svn commit: r452589 - in\n /incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri:\n Constants.java HttpScheme.java IRI.java"}
{"body": "Author: jmsnell\nDate: Tue Oct  3 14:00:44 2006\nNew Revision: 452619\n\nURL: http://svn.apache.org/viewvc?view=rev&rev=452619\nLog:\nMuch better IRI parsing based on the regex given in RFC3986.  This should make the parse more efficient\nsupport for non-typical URI schemes much easier and more robust.  All the tests still pass (at east on\nmy machine).  Please give the IRI test cases a run through to ensure that no new charset issues have\ncrept up.\n\nAdded:\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/DefaultScheme.java\nRemoved:\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Builder.java\nModified:\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/CharUtils.java\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/AbstractScheme.java\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/HttpScheme.java\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Scheme.java\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/SchemeRegistry.java\n    incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/CharUtils.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/CharUtils.java?view=diff&rev=452619&r1=452618&r2=452619\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/CharUtils.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/CharUtils.java Tue Oct  3 14:00:44 2006\n@@ -86,6 +86,7 @@\n   }\n   \n   public static void verify(String s, BitSet set) throws InvalidCharacterException {\n+    if (s == null) return;\n     CodepointIterator ci = CodepointIterator.forCharSequence(s);\n     RestrictedCodepointIterator rci = new RestrictedCodepointIterator(ci,set,false);\n     while (rci.hasNext()) rci.next();\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/AbstractScheme.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/AbstractScheme.java?view=diff&rev=452619&r1=452618&r2=452619\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/AbstractScheme.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/AbstractScheme.java Tue Oct  3 14:00:44 2006\n@@ -17,8 +17,6 @@\n */\n package org.apache.abdera.util.iri;\n \n-import org.apache.abdera.util.io.CodepointIterator;\n-\n /**\n  * Base implementation for IRI scheme providers\n  */\n@@ -45,15 +43,16 @@\n   }\n   \n   /**\n-   * Default to use default parsing\n+   * Default return unmodified\n    */\n-  public boolean parse(\n-    CodepointIterator reader, \n-    Builder builder) {\n-      return false;\n-  }\n-\n   public IRI normalize(IRI iri) {\n-    return null;\n+    return iri;\n+  }\n+  \n+  /**\n+   * Default return unmodified\n+   */\n+  public String normalizePath(String path) {\n+    return path;\n   }\n }\n\nAdded: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/DefaultScheme.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/DefaultScheme.java?view=auto&rev=452619\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/DefaultScheme.java (added)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/DefaultScheme.java Tue Oct  3 14:00:44 2006\n@@ -0,0 +1,26 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  The ASF licenses this file to You\n+* under the Apache License, Version 2.0 (the \"License\"); you may not\n+* use this file except in compliance with the License.\n+* You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.  For additional information regarding\n+* copyright in this work, please see the NOTICE file in the top level\n+* directory of this distribution.\n+*/\n+package org.apache.abdera.util.iri;\n+\n+public class DefaultScheme extends AbstractScheme {\n+\n+  public DefaultScheme(String name) {\n+    super(name);\n+  }\n+\n+}\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/HttpScheme.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/HttpScheme.java?view=diff&rev=452619&r1=452618&r2=452619\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/HttpScheme.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/HttpScheme.java Tue Oct  3 14:00:44 2006\n@@ -46,7 +46,8 @@\n       return true;\n     if (!iri1.getScheme().equals(iri2.getScheme()))\n       return false;\n-    \n+    iri1 = iri1.normalize();\n+    iri2 = iri2.normalize();\n     int port1 = (iri1.getPort() != -1) ? iri1.getPort() : getDefaultPort();\n     int port2 = (iri2.getPort() != -1) ? iri2.getPort() : getDefaultPort();\n     return\n@@ -81,9 +82,13 @@\n         port,\n         IRI.normalize(this,iri.getPath()),\n         iri.getQuery(),\n-        iri.getFragment(),\n-        iri.doubleslash\n+        iri.getFragment()\n       );\n+  }\n+  \n+  // use the path normalization coded into the IRI class \n+  public String normalizePath(String path) {\n+    return null;\n   }\n   \n }\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java?view=diff&rev=452619&r1=452618&r2=452619\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java Tue Oct  3 14:00:44 2006\n@@ -1,20 +1,3 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  The ASF licenses this file to You\n- * under the Apache License, Version 2.0 (the \"License\"); you may not\n- * use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.  For additional information regarding\n- * copyright in this work, please see the NOTICE file in the top level\n- * directory of this distribution.\n- */\n package org.apache.abdera.util.iri;\n \n import java.io.IOException;\n@@ -22,17 +5,17 @@\n import java.io.UnsupportedEncodingException;\n import java.net.MalformedURLException;\n import java.net.URISyntaxException;\n-import java.util.BitSet;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n \n import org.apache.abdera.util.io.CharUtils;\n-import org.apache.abdera.util.io.CodepointIterator;\n+import org.apache.abdera.util.io.InvalidCharacterException;\n import org.apache.abdera.util.unicode.Normalizer;\n \n-\n public class IRI \n   implements Serializable, \n              Cloneable {\n-\n+  \n   private static final long serialVersionUID = -4530530782760282284L;\n   Scheme _scheme;\n   private String scheme;\n@@ -43,7 +26,6 @@\n   private String path;\n   private String query;\n   private String fragment;\n-  boolean doubleslash;\n \n   private String a_host;\n   private String a_fragment;\n@@ -97,8 +79,7 @@\n       b.port,\n       b.path,\n       b.query,\n-      b.fragment,\n-      b.doubleslash);\n+      b.fragment);\n   }\n   \n   public IRI(String iri, Normalizer.Form nf) throws IRISyntaxException, IOException {\n@@ -118,9 +99,8 @@\n       StringBuffer buf = new StringBuffer();\n       buildAuthority(buf,userinfo, host, port);\n       String authority = (buf.length()!=0)?buf.toString():null;\n-      boolean doubleslash = (authority != null);\n       init(_scheme,scheme,authority,userinfo,\n-        host,port,path,query,fragment,doubleslash);\n+        host,port,path,query,fragment);\n   }\n   \n   public IRI(\n@@ -128,16 +108,15 @@\n     String authority,\n     String path,\n     String query,\n-    String fragment) {\n-      Builder builder = new Builder();\n-      if (authority != null)\n-        splitAuthority(authority, builder);\n-      SchemeRegistry reg = SchemeRegistry.getInstance();\n-      Scheme _scheme = reg.getScheme(scheme);\n-      boolean doubleslash = (authority != null);\n-      init(_scheme,scheme,authority,builder.userinfo,\n-        builder.host,builder.port,path,query,\n-        fragment,doubleslash);\n+    String fragment) \n+      throws IRISyntaxException {\n+    Builder builder = new Builder();\n+    Parser.parseAuthority(authority, builder);\n+    SchemeRegistry reg = SchemeRegistry.getInstance();\n+    Scheme _scheme = reg.getScheme(scheme);\n+    init(_scheme,scheme,authority,builder.userinfo,\n+      builder.host,builder.port,path,query,\n+      fragment);\n   }\n   \n   public IRI(\n@@ -157,10 +136,9 @@\n     int port,\n     String path,\n     String query,\n-    String fragment,\n-    boolean doubleslash) {\n+    String fragment) {\n       init(_scheme,scheme,authority,userinfo,\n-         host,port,path,query,fragment,doubleslash);\n+         host,port,path,query,fragment);\n   }\n   \n   private void init(\n@@ -172,8 +150,7 @@\n       int port,\n       String path,\n       String query,\n-      String fragment,\n-      boolean doubleslash) {\n+      String fragment) {\n     this._scheme = _scheme;\n     this.scheme = scheme;\n     this.authority = authority;\n@@ -183,18 +160,17 @@\n     this.path = (path != null) ? path : \"\";\n     this.query = query;\n     this.fragment = fragment;\n-    this.doubleslash = doubleslash;\n     \n     d_authority = Escaping.decode(authority);\n     d_userinfo = Escaping.decode(userinfo);\n     d_path = Escaping.decode(path);\n     d_query = Escaping.decode(query);\n     d_fragment = Escaping.decode(fragment);\n-    d_host = Escaping.decode(host);\n+    d_host = IDNA.toUnicode(Escaping.decode(host));\n \n     a_host = IDNA.toASCII(d_host);\n     a_fragment = Escaping.encode(getFragment(),Constants.FRAGMENT);\n-    a_path = normalize(_scheme,Escaping.encode(getPath(), Constants.PATH));\n+    a_path = Escaping.encode(getPath(), Constants.PATH);\n     a_query = Escaping.encode(getQuery(),Constants.QUERY);\n     a_userinfo = Escaping.encode(getUserInfo(),Constants.USERINFO);\n     a_authority = buildASCIIAuthority();\n@@ -376,7 +352,11 @@\n       buildAuthority(buf,aui,ah,port);\n       return buf.toString();\n     } else {\n-      return Escaping.encode(getAuthority(), Constants.USERINFO, Constants.REGNAME);\n+      return Escaping.encode(\n+        getAuthority(), \n+        Constants.USERINFO, \n+        Constants.REGNAME, \n+        Constants.GENDELIMS);\n     }\n   }\n   \n@@ -414,8 +394,10 @@\n     String query,\n     String fragment) {\n       StringBuffer buf = new StringBuffer();\n-      if (doubleslash) buf.append(\"//\");\n-      if (authority != null) buf.append(authority);\n+      if (authority != null) {\n+        buf.append(\"//\");\n+        buf.append(authority);\n+      }\n       if (path != null && path.length() != 0) {\n         buf.append(path);\n       }\n@@ -461,8 +443,7 @@\n       null,null,null,null,-1,\n       normalize(b._scheme,cpath.substring(bpath.length())), \n       c.getQuery(), \n-      c.getFragment(), \n-      false);\n+      c.getFragment());\n     return iri;\n   }\n   \n@@ -484,7 +465,11 @@\n            query == null;\n   }\n   \n-  public static IRI resolve(IRI b, String c) throws IRISyntaxException, IOException {\n+  public static IRI resolve(\n+    IRI b, \n+    String c) \n+      throws IRISyntaxException, \n+             IOException {\n     return resolve(b, IRI.create(c));\n   }\n   \n@@ -510,8 +495,7 @@\n           b.getPort(),\n           normalize(b._scheme,b.getPath()),\n           b.getQuery(),\n-          cfragment,\n-          b.doubleslash\n+          cfragment\n         );\n       }\n     }\n@@ -519,7 +503,6 @@\n     \n     Scheme _scheme = b._scheme;\n     String scheme = b.scheme;\n-    boolean ds = b.doubleslash;\n     String query = c.getQuery();\n     String fragment = c.getFragment();\n     String userinfo = null;\n@@ -542,7 +525,16 @@\n       port = c.getPort();\n       path = normalize(b._scheme,c.getPath());\n     }\n-    return new IRI(_scheme,scheme,authority,userinfo,host,port,path,query,fragment,ds);\n+    return new IRI(\n+      _scheme,\n+      scheme,\n+      authority,\n+      userinfo,\n+      host,\n+      port,\n+      path,\n+      query,\n+      fragment);\n   }\n   \n   public IRI normalize() {\n@@ -564,14 +556,16 @@\n         iri.getPort(),\n         normalize(iri._scheme,iri.getPath()),\n         iri.getQuery(),\n-        iri.getFragment(),\n-        iri.doubleslash\n+        iri.getFragment()\n       );\n   }\n \n   static String normalize(Scheme scheme, String path) {\n-    if (scheme != null && !(scheme instanceof HttpScheme)) return path;\n-    if (path == null) return \"/\";\n+    if (scheme != null) {\n+      String n = scheme.normalizePath(path);\n+      if (n != null) return n;\n+    }\n+    if (path == null || path.length() == 0) return \"/\";\n     String[] segments = path.split(\"/\");\n     if (segments.length < 2) return path;\n     StringBuffer buf = new StringBuffer(\"/\");\n@@ -651,61 +645,46 @@\n     return buf.toString();\n   }\n   \n-  public java.net.URI toURI() throws URISyntaxException {\n-    return new java.net.URI(toASCIIString());\n+  public java.net.URI toURI() \n+    throws URISyntaxException {\n+      return new java.net.URI(toASCIIString());\n   }\n   \n-  public java.net.URL toURL() throws MalformedURLException, URISyntaxException {\n+  public java.net.URL toURL() \n+    throws MalformedURLException, \n+           URISyntaxException {\n     return toURI().toURL();\n   }\n   \n   ////////// parse implementation\n   \n-  private static void parse(String uri, Builder builder) throws IRISyntaxException {\n-    SchemeRegistry reg = SchemeRegistry.getInstance();\n-    builder.chars = uri.toCharArray();\n-    CodepointIterator ci = CodepointIterator.forCharArray(builder.chars);\n+  private static void parse(\n+    String uri,\n+    Builder builder) \n+      throws IRISyntaxException {\n     try {\n-      Parser.parse(ci, builder, reg);\n+      Parser.parse(uri, builder, SchemeRegistry.getInstance());\n     } catch (IOException e) {\n       throw new IRISyntaxException(e);\n     }\n   }\n   \n-  public static IRI create(String iri) throws IRISyntaxException {\n+  public static IRI create(\n+    String iri) \n+      throws IRISyntaxException {\n     return new IRI(iri);\n   }\n   \n-  public static IRI create(String iri, Normalizer.Form nf) throws IRISyntaxException, IOException {\n+  public static IRI create(\n+    String iri, \n+    Normalizer.Form nf) \n+      throws IRISyntaxException, \n+             IOException {\n     return new IRI(iri,nf);\n   }\n   \n-  static void splitAuthority(String authority, Builder builder) {\n-    if (authority != null) {\n-      int n = authority.indexOf('@');\n-      if (n > -1) builder.userinfo = authority.substring(0,n);\n-      int a = authority.indexOf('[',n);\n-      if (a > -1) {\n-        int m = authority.indexOf(']',a);\n-        if (m > -1) a = m;\n-        a = authority.indexOf(':',a);\n-      } else\n-      a = authority.indexOf(':',n);\n-      if (a > -1) {\n-        builder.host = authority.substring(n+1,a);\n-        String p = authority.substring(a+1);\n-        if (p.length() > 0) {\n-          try {\n-            builder.port = Integer.parseInt(p);\n-          } catch (Exception e) {}\n-        }\n-      } else builder.host = authority.substring(n+1);\n-    }\n-  }\n-  \n-  static class Builder implements org.apache.abdera.util.iri.Builder {\n+  static class Builder {\n     private Scheme schemeobj;\n-    private char[] chars;\n     private String scheme;\n     private String authority;\n     private String userinfo;\n@@ -714,104 +693,69 @@\n     private String path;\n     private String query;\n     private String fragment;\n-    private boolean doubleslash;\n-    \n-    private void setScheme(Scheme scheme) {\n-      this.schemeobj = scheme;\n-    }\n-    \n-    public void scheme(int s, int l) {\n-      scheme = (l > 0) ? new String(chars,s,l).toLowerCase() : null;\n-    }\n-    public void authority(int s, int l) {\n-      authority = (l > 0) ? new String(chars,s,l) : null;\n-      splitAuthority(authority, this);\n-    }\n-    public void path(int s, int l) {\n-      path = (l > 0) ? new String(chars,s,l) : null;\n-    }\n-    public void query(int s, int l) {\n-      query = (l > 0) ? new String(chars,s,l) : null;\n-    }\n-    public void fragment(int s, int l) {\n-      fragment = (l > 0) ? new String(chars,s,l) : null;\n-    }\n     \n     public IRI getAtomURI() {\n       return new IRI(\n         schemeobj,\n         scheme,authority,userinfo,\n-        host,port,path,query,fragment, \n-        doubleslash);\n+        host,port,path,query,fragment);\n     }\n   }\n   \n   static class Parser {\n-    static void parse(CodepointIterator ci, Builder builder, SchemeRegistry reg) \n+    \n+    static final Pattern p = \n+      Pattern.compile(\n+        \"^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\\\?([^#]*))?(#(.*))?\");\n+    \n+    static final Pattern a =\n+      Pattern.compile(\"^((.*)?@)?(\\\\[.*\\\\])?([^:]*)?(:(\\\\d*))?\");\n+    \n+    static void parseAuthority(String authority, Builder builder) throws IRISyntaxException {\n+      if (authority != null) {\n+        Matcher auth = a.matcher(authority);\n+        if (auth.find()) {\n+          if (auth.group(2) != null) builder.userinfo = auth.group(2);\n+          if (auth.group(3) != null) builder.host = auth.group(3);\n+          else builder.host = auth.group(4);\n+          if (auth.group(6) != null) builder.port = Integer.parseInt(auth.group(6));\n+        }\n+        try {\n+          CharUtils.verify(builder.userinfo, Constants.IUSERINFO);\n+          CharUtils.verify(builder.host, Constants.IREGNAME);\n+        } catch (InvalidCharacterException e) {\n+          throw new IRISyntaxException(e);\n+        }\n+      }\n+    }\n+    \n+    static void parse(String iri, Builder builder, SchemeRegistry reg) \n       throws IRISyntaxException, \n              IOException {\n-      int e = ci.position();\n-      scan(ci,Constants.SCHEME,-1);\n-      if (ci.peek() == ':')\n-        builder.scheme(e,ci.position()-e);\n-      Scheme _scheme = null;\n-      if (builder.scheme != null && builder.scheme.length() != 0) {\n-        _scheme = reg.getScheme(builder.scheme);\n-      } else { ci.position(e); }\n-      if (_scheme != null) {\n-        // allow for scheme specific parsing. if the resolved scheme\n-        // does parse the result, skip the rest, otherwise, do the \n-        // default parsing\n-        builder.setScheme(_scheme);\n-        if (_scheme.parse(ci, builder)) return;\n-      }\n-      // default parsing. works for most common schemes\n-      scan(ci, Constants.COLON,1);\n-      e = ci.position();\n-      if (ci.peek() == '/' && \n-          ci.peek(ci.position() + 1) == '/') {\n-        scan(ci,Constants.SLASH,2);\n-        builder.doubleslash = true;\n-      }\n-      e = ci.position();\n-      int f = find(ci,Constants.SEPS);\n-      if(f != 0) {\n-        scan(ci,Constants.ISERVER,-1);\n-      if (ci.peek() == -1 || CharUtils.isSet(ci.peek(), Constants.SEPS)) {        \n-        builder.authority(e,ci.position()-e);\n-      }\n-      else ci.position(e);\n-      e = ci.position();\n+      Matcher irim = p.matcher(iri);\n+      if (irim.find()) {\n+        \n+        builder.scheme = irim.group(2);\n+        builder.schemeobj = reg.getScheme(builder.scheme);\n+        builder.authority = irim.group(4);\n+        builder.path = irim.group(5);\n+        builder.query = irim.group(7);\n+        builder.fragment = irim.group(9);\n+        \n+        parseAuthority(builder.authority, builder);\n+        \n+        try {\n+          CharUtils.verify(builder.scheme, Constants.SCHEME);\n+          CharUtils.verify(builder.path, Constants.IPATH);\n+          CharUtils.verify(builder.query, Constants.IQUERY);\n+          CharUtils.verify(builder.fragment, Constants.IFRAGMENT);\n+        } catch (InvalidCharacterException e) {\n+          throw new IRISyntaxException(e);\n+        }\n+      } else {\n+        throw new IRISyntaxException(\"Invalid Syntax\");\n       }\n-      scan(ci,Constants.IPATH,-1);\n-      builder.path(e,ci.position()-e);\n-      scan(ci,Constants.QUERYMARK,-1);\n-      e = ci.position();\n-      scan(ci,Constants.IQUERY,-1);\n-      builder.query(e,ci.position()-e);\n-      scan(ci,Constants.HASH,-1);\n-      e = ci.position();\n-      scan(ci,Constants.IFRAGMENT,-1);\n-      builder.fragment(e,ci.position()-e);\n     }\n   }\n   \n-  private static int find(CodepointIterator ci, BitSet set) throws IOException {\n-    int n = ci.position();\n-    int c = -1;\n-    while((c = ci.peek(n++)) != -1 && set.get(c)) { n++; } \n-    return n-1;\n-  }\n-  \n-  private static int scan(CodepointIterator ci, BitSet set, int count) throws IOException, IRISyntaxException {\n-    while (ci.hasNext() && ci.peek() != -1 && set.get(ci.peek())){ \n-      int p = ci.next();\n-      if (!set.get(p)) {\n-        if (!CharUtils.isSet(p, Constants.RESERVED, Constants.IUNRESERVED, Constants.HASH)) \n-          throw new IRISyntaxException(\"Invalid Character (0x\" + Integer.toHexString(p) + \") In URI\");\n-        return -1;\n-      }\n-    }\n-    return -1;\n-  }\n }\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Scheme.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Scheme.java?view=diff&rev=452619&r1=452618&r2=452619\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Scheme.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/Scheme.java Tue Oct  3 14:00:44 2006\n@@ -17,8 +17,6 @@\n */\n package org.apache.abdera.util.iri;\n \n-import org.apache.abdera.util.io.CodepointIterator;\n-\n /**\n  * Interface implemented by custom IRI scheme parsers\n  */\n@@ -28,8 +26,8 @@\n   \n   boolean equivalent(IRI iri1, IRI iri2);\n   \n-  boolean parse(CodepointIterator reader, Builder builder);\n-  \n   IRI normalize(IRI iri); \n+  \n+  String normalizePath(String path);\n   \n }\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/SchemeRegistry.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/SchemeRegistry.java?view=diff&rev=452619&r1=452618&r2=452619\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/SchemeRegistry.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/SchemeRegistry.java Tue Oct  3 14:00:44 2006\n@@ -69,7 +69,9 @@\n   }\n   \n   public Scheme getScheme(String scheme) {\n-    return schemes.get(scheme.toLowerCase());\n+    if (scheme == null) return null;\n+    Scheme s = schemes.get(scheme.toLowerCase());\n+    return (s != null) ? s : new DefaultScheme(scheme);\n   }\n   \n }\n\nModified: incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java?view=diff&rev=452619&r1=452618&r2=452619\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java (original)\n+++ incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java Tue Oct  3 14:00:44 2006\n@@ -81,19 +81,20 @@\n     assertFalse(iri3.equals(iri1)); // false\n     assertFalse(iri3.equals(iri2)); // false\n     \n-    assertTrue(iri1.normalize().equals(iri2.normalize()));  //true\n-    assertFalse(iri1.normalize().equals(iri3.normalize()));  //false\n-    assertTrue(iri2.normalize().equals(iri1.normalize()));  //true\n-    assertFalse(iri2.normalize().equals(iri3.normalize()));  //false\n-    assertFalse(iri3.normalize().equals(iri1.normalize()));  //false\n-    assertFalse(iri3.normalize().equals(iri2.normalize()));  //false\n     \n-    assertTrue(iri1.equivalent(iri2)); // true\n-    assertTrue(iri1.equivalent(iri3)); // true\n-    assertTrue(iri2.equivalent(iri1)); // true\n-    assertTrue(iri2.equivalent(iri3)); // true\n-    assertTrue(iri3.equivalent(iri1)); // true\n-    assertTrue(iri3.equivalent(iri2)); // true\n+    assertTrue(iri1.normalize().equals(iri2.normalize()));\n+    assertTrue(iri1.normalize().equals(iri3.normalize()));\n+    assertTrue(iri2.normalize().equals(iri1.normalize()));\n+    assertTrue(iri2.normalize().equals(iri3.normalize()));\n+    assertTrue(iri3.normalize().equals(iri1.normalize()));\n+    assertTrue(iri3.normalize().equals(iri2.normalize()));\n+    \n+    assertTrue(iri1.equivalent(iri2));\n+    assertTrue(iri1.equivalent(iri3));\n+    assertTrue(iri2.equivalent(iri1));\n+    assertTrue(iri2.equivalent(iri3));\n+    assertTrue(iri3.equivalent(iri1));\n+    assertTrue(iri3.equivalent(iri2));\n   }\n   \n   \n\n\n", "message_to": "abdera-commits@incubator.apache.org", "message_from": "jmsnell@apache.org", "references": null, "message_uuid": "1cda0db05e1c11e3a468fa163e1e9c80", "list_id": "abdera-commits.incubator.apache.org", "date": "Tue, 03 Oct 2006 21:00:45 -0000", "in_reply_to": null, "message_id": "20061003210045.AF6641A981A@eris.apache.org", "subject": "svn commit: r452619 - in /incubator/abdera/java/trunk/core/src:\n main/java/org/apache/abdera/util/io/ main/java/org/apache/abdera/util/iri/\n test/java/org/apache/abdera/test/iri/"}
{"body": "Author: jmsnell\nDate: Tue Oct  3 14:20:26 2006\nNew Revision: 452626\n\nURL: http://svn.apache.org/viewvc?view=rev&rev=452626\nLog:\nAdd a test for various uri schemes\n\nModified:\n    incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java\n\nModified: incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java?view=diff&rev=452626&r1=452625&r2=452626\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java (original)\n+++ incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java Tue Oct  3 14:20:26 2006\n@@ -132,4 +132,74 @@\n     assertEquals(base.resolve(\".\").toString(),\"http://example.org/foo/\");\n   }\n \n+  /**\n+   * Try a variety of URI schemes.  If any problematic schemes pop up, \n+   * we should add a test for 'em here\n+   */\n+  public static void testSchemes() throws Exception {\n+    \n+    IRI iri = new IRI(\"http://a:b@c.org:80/d/e?f#g\");\n+    assertEquals(iri.getScheme(), \"http\");\n+    assertEquals(iri.getUserInfo(), \"a:b\");\n+    assertEquals(iri.getHost(),\"c.org\");\n+    assertEquals(iri.getPort(),80);\n+    assertEquals(iri.getPath(),\"/d/e\");\n+    assertEquals(iri.getQuery(), \"f\");\n+    assertEquals(iri.getFragment(),\"g\");\n+    \n+    iri = new IRI(\"https://a:b@c.org:80/d/e?f#g\");\n+    assertEquals(iri.getScheme(), \"https\");\n+    assertEquals(iri.getUserInfo(), \"a:b\");\n+    assertEquals(iri.getHost(),\"c.org\");\n+    assertEquals(iri.getPort(),80);\n+    assertEquals(iri.getPath(),\"/d/e\");\n+    assertEquals(iri.getQuery(), \"f\");\n+    assertEquals(iri.getFragment(),\"g\");\n+    \n+    iri = new IRI(\"ftp://a:b@c.org:80/d/e?f#g\");\n+    assertEquals(iri.getScheme(), \"ftp\");\n+    assertEquals(iri.getUserInfo(), \"a:b\");\n+    assertEquals(iri.getHost(),\"c.org\");\n+    assertEquals(iri.getPort(),80);\n+    assertEquals(iri.getPath(),\"/d/e\");\n+    assertEquals(iri.getQuery(), \"f\");\n+    assertEquals(iri.getFragment(),\"g\");\n+    \n+    iri = new IRI(\"mailto:joe@example.org?subject=foo\");\n+    assertEquals(iri.getScheme(), \"mailto\");\n+    assertEquals(iri.getUserInfo(), null);\n+    assertEquals(iri.getHost(),null);\n+    assertEquals(iri.getPort(),-1);\n+    assertEquals(iri.getPath(),\"joe@example.org\");\n+    assertEquals(iri.getQuery(), \"subject=foo\");\n+    assertEquals(iri.getFragment(),null);\n+    \n+    iri = new IRI(\"tag:example.org,2006:foo\");\n+    assertEquals(iri.getScheme(), \"tag\");\n+    assertEquals(iri.getUserInfo(), null);\n+    assertEquals(iri.getHost(),null);\n+    assertEquals(iri.getPort(),-1);\n+    assertEquals(iri.getPath(),\"example.org,2006:foo\");\n+    assertEquals(iri.getQuery(), null);\n+    assertEquals(iri.getFragment(),null);\n+    \n+    iri = new IRI(\"urn:lsid:ibm.com:example:82437234964354895798234d\");\n+    assertEquals(iri.getScheme(), \"urn\");\n+    assertEquals(iri.getUserInfo(), null);\n+    assertEquals(iri.getHost(),null);\n+    assertEquals(iri.getPort(),-1);\n+    assertEquals(iri.getPath(),\"lsid:ibm.com:example:82437234964354895798234d\");\n+    assertEquals(iri.getQuery(), null);\n+    assertEquals(iri.getFragment(),null);\n+    \n+    iri = new IRI(\"data:image/gif;base64,R0lGODdhMAAwAPAAAAAAAP\");\n+    assertEquals(iri.getScheme(), \"data\");\n+    assertEquals(iri.getUserInfo(), null);\n+    assertEquals(iri.getHost(),null);\n+    assertEquals(iri.getPort(),-1);\n+    assertEquals(iri.getPath(),\"image/gif;base64,R0lGODdhMAAwAPAAAAAAAP\");\n+    assertEquals(iri.getQuery(), null);\n+    assertEquals(iri.getFragment(),null);\n+    \n+  }\n }\n\n\n", "message_to": "abdera-commits@incubator.apache.org", "message_from": "jmsnell@apache.org", "references": null, "message_uuid": "1cda3c865e1c11e3a468fa163e1e9c80", "list_id": "abdera-commits.incubator.apache.org", "date": "Tue, 03 Oct 2006 21:20:27 -0000", "in_reply_to": null, "message_id": "20061003212027.55C2E1A981A@eris.apache.org", "subject": "svn commit: r452626 -\n /incubator/abdera/java/trunk/core/src/test/java/org/apache/abdera/test/iri/TestIRI.java"}
{"body": "Author: jmsnell\nDate: Tue Oct  3 14:51:49 2006\nNew Revision: 452642\n\nURL: http://svn.apache.org/viewvc?view=rev&rev=452642\nLog:\nAdditional bidi support designed to make it easier to work with bidi strings.\n\nFor instance, if you'd like to insert right-to-left plain-text characters in the title of an entry,\nyou can do so using:\n\n  entry.setTitle(CharUtils.bidiRLM(\"text with right-to-left characters\"));\n\n\nModified:\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/CharUtils.java\n    incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/CharUtils.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/CharUtils.java?view=diff&rev=452642&r1=452641&r2=452642\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/CharUtils.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/io/CharUtils.java Tue Oct  3 14:51:49 2006\n@@ -237,4 +237,81 @@\n       String.valueOf((char)c);\n   }\n   \n+  \n+\n+  private static final char LRE = 0x202A; \n+  private static final char RLE = 0x202B; \n+  private static final char LRO = 0x202D; \n+  private static final char RLO = 0x202E; \n+  private static final char LRM = 0x200E; \n+  private static final char RLM = 0x200F;\n+  private static final char PDF = 0x202C;\n+  \n+  /**\n+   * Removes leading and trailing bidi controls from the string\n+   */\n+  public static String stripBidi(String s) {\n+    if (s == null || s.length() <= 1) return s;\n+    if (charIsBidiControl(s.charAt(0)))\n+      s = s.substring(1);\n+    if (charIsBidiControl(s.charAt(s.length()-1)))\n+      s = s.substring(0,s.length()-1);\n+    return s;\n+  }\n+  \n+  /**\n+   * Returns true if the character is a bidi control \n+   */\n+  public static boolean charIsBidiControl(char c) {\n+    return c == 0x202A ||\n+    c == LRE ||\n+    c == RLE ||\n+    c == LRO ||\n+    c == RLO ||\n+    c == RLM ||\n+    c == LRM || \n+    c == PDF;\n+  }\n+  \n+  /**\n+   * Wrap the string with Bidi Right-to-Left embed\n+   */\n+  public static String bidiRLE(String s) {\n+    return RLE + s + PDF;\n+  }\n+  \n+  /**\n+   * Wrap the string with Bidi Right-to-Left override \n+   */\n+  public static String bidiRLO(String s) {\n+    return RLO + s + PDF;\n+  }\n+  \n+  /**\n+   * Wrap the string with Bidi Left-to-Right embed\n+   */\n+  public static String bidiLRE(String s) {\n+    return LRE + s + PDF;\n+  }\n+  \n+  /**\n+   * Wrap the string with Bidi Left-to-Right override\n+   */\n+  public static String bidiLRO(String s) {\n+    return LRO + s + PDF;\n+  }\n+  \n+  /**\n+   * Wrap the string with Bidi RML marks\n+   */\n+  public static String bidiRLM(String s) {\n+    return RLM + s + RLM;\n+  }\n+  \n+  /**\n+   * Wrap the string with Bidi LRM marks\n+   */\n+  public static String bidiLRM(String s) {\n+    return LRM + s + RLM;\n+  }\n }\n\nModified: incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java?view=diff&rev=452642&r1=452641&r2=452642\n==============================================================================\n--- incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java (original)\n+++ incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util/iri/IRI.java Tue Oct  3 14:51:49 2006\n@@ -69,7 +69,7 @@\n   \n   public IRI(String iri) throws IRISyntaxException {\n     Builder b = new Builder();\n-    parse(iri, b);\n+    parse(CharUtils.stripBidi(iri), b);\n     init(\n       b.schemeobj,\n       b.scheme,\n@@ -83,7 +83,7 @@\n   }\n   \n   public IRI(String iri, Normalizer.Form nf) throws IRISyntaxException, IOException {\n-    this(Normalizer.normalize(iri,nf).toString());\n+    this(Normalizer.normalize(CharUtils.stripBidi(iri),nf).toString());\n   }\n   \n   public IRI(\n@@ -637,12 +637,7 @@\n   }\n   \n   public String toBIDIString() {\n-    StringBuffer buf = new StringBuffer(toString());\n-    if (buf.length() > 0) {\n-      if (buf.charAt(0) != '\\u202A') buf.insert(0,'\\u202A');\n-      if (buf.charAt(buf.length()-1) != '\\u202C') buf.append('\\u202C');\n-    }\n-    return buf.toString();\n+    return CharUtils.bidiLRE(toString());\n   }\n   \n   public java.net.URI toURI() \n\n\n", "message_to": "abdera-commits@incubator.apache.org", "message_from": "jmsnell@apache.org", "references": null, "message_uuid": "1cda53745e1c11e3a468fa163e1e9c80", "list_id": "abdera-commits.incubator.apache.org", "date": "Tue, 03 Oct 2006 21:51:50 -0000", "in_reply_to": null, "message_id": "20061003215150.6CB7A1A981D@eris.apache.org", "subject": "svn commit: r452642 - in\n /incubator/abdera/java/trunk/core/src/main/java/org/apache/abdera/util:\n io/CharUtils.java iri/IRI.java"}
{"body": "Author: jmsnell\nDate: Wed Oct  4 13:00:39 2006\nNew Revision: 452996\n\nURL: http://svn.apache.org/viewvc?view=rev&rev=452996\nLog:\nInitial support for Mark Nottingham's Feed History specification. The current draft has entered last-call\nstatus making it important to get some interop testing done.  This code does not perform reconstruction\nof feed state but it does provide easier access to the various extensions and relevant links.\n\n(http://ietfreport.isoc.org/all-ids/draft-nottingham-atompub-feed-history-07.txt)\n\nAdded:\n    incubator/abdera/java/trunk/extensions/src/main/java/org/apache/abdera/ext/history/\n    incubator/abdera/java/trunk/extensions/src/main/java/org/apache/abdera/ext/history/FeedHistoryHelper.java\n    incubator/abdera/java/trunk/extensions/src/test/java/org/apache/abdera/test/ext/history/\n    incubator/abdera/java/trunk/extensions/src/test/java/org/apache/abdera/test/ext/history/HistoryTest.java\n\nAdded: incubator/abdera/java/trunk/extensions/src/main/java/org/apache/abdera/ext/history/FeedHistoryHelper.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/extensions/src/main/java/org/apache/abdera/ext/history/FeedHistoryHelper.java?view=auto&rev=452996\n==============================================================================\n--- incubator/abdera/java/trunk/extensions/src/main/java/org/apache/abdera/ext/history/FeedHistoryHelper.java (added)\n+++ incubator/abdera/java/trunk/extensions/src/main/java/org/apache/abdera/ext/history/FeedHistoryHelper.java Wed Oct  4 13:00:39 2006\n@@ -0,0 +1,190 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  The ASF licenses this file to You\n+* under the Apache License, Version 2.0 (the \"License\"); you may not\n+* use this file except in compliance with the License.\n+* You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.  For additional information regarding\n+* copyright in this work, please see the NOTICE file in the top level\n+* directory of this distribution.\n+*/\n+package org.apache.abdera.ext.history;\n+\n+import javax.xml.namespace.QName;\n+\n+import org.apache.abdera.model.Feed;\n+import org.apache.abdera.model.Link;\n+import org.apache.abdera.util.iri.IRI;\n+import org.apache.abdera.util.iri.IRISyntaxException;\n+\n+/**\n+ * Initial support for Mark Nottingham's Feed History draft \n+ * (http://ietfreport.isoc.org/all-ids/draft-nottingham-atompub-feed-history-07.txt)\n+ */\n+public class FeedHistoryHelper {\n+\n+  public static final String FHNS = \"http://purl.org/syndication/history/1.0\";\n+  public static final QName COMPLETE = new QName(FHNS, \"complete\");\n+  public static final QName ARCHIVE = new QName(FHNS, \"archive\");\n+  \n+  public static boolean isComplete(Feed feed) {\n+    return (feed.getExtension(COMPLETE) != null);\n+  }\n+  \n+  public static void setComplete(Feed feed, boolean complete) {\n+    if (complete) {\n+      if (!isComplete(feed)) feed.addExtension(COMPLETE);\n+    } else {\n+      if (isComplete(feed)) feed.getExtension(COMPLETE).discard(); \n+    }\n+  }\n+  \n+  public static void setArchive(Feed feed, boolean archive) {\n+    if (archive) {\n+      if (!isArchive(feed)) feed.addExtension(ARCHIVE);\n+    } else {\n+      if (isArchive(feed)) feed.getExtension(ARCHIVE).discard(); \n+    }\n+  }\n+\n+  public static boolean isArchive(Feed feed) {\n+    return feed.getExtension(ARCHIVE) != null;\n+  }\n+  \n+  public static boolean isPaged(Feed feed) {\n+    return feed.getLink(\"next\") != null ||\n+           feed.getLink(\"previous\") != null ||\n+           feed.getLink(\"first\") != null ||\n+           feed.getLink(\"last\") != null;\n+  }\n+  \n+  public static Link setNext(Feed feed, String iri) throws IRISyntaxException {\n+    Link link = feed.getLink(\"next\");\n+    if (link != null) {\n+      link.setHref(iri);\n+    } else {\n+      link = feed.addLink(iri, \"next\");\n+    }\n+    return link;\n+  }\n+  \n+  public static Link setPrevious(Feed feed, String iri) throws IRISyntaxException {\n+    Link link = feed.getLink(\"previous\");\n+    if (link != null) {\n+      link.setHref(iri);\n+    } else {\n+      link = feed.addLink(iri, \"previous\");\n+    }\n+    return link;\n+  }\n+  \n+  public static Link setFirst(Feed feed, String iri) throws IRISyntaxException {\n+    Link link = feed.getLink(\"first\");\n+    if (link != null) {\n+      link.setHref(iri);\n+    } else {\n+      link = feed.addLink(iri, \"first\");\n+    }\n+    return link;\n+  }\n+  \n+  public static Link setLast(Feed feed, String iri) throws IRISyntaxException {\n+    Link link = feed.getLink(\"last\");\n+    if (link != null) {\n+      link.setHref(iri);\n+    } else {\n+      link = feed.addLink(iri, \"last\");\n+    }\n+    return link;\n+  }\n+  \n+  public static Link setNextArchive(Feed feed, String iri) throws IRISyntaxException {\n+    Link link = feed.getLink(\"next-archive\");\n+    if (link == null) { // try the full IANA URI version\n+      link = feed.getLink(Link.IANA_BASE + \"next-archive\");\n+    }\n+    if (link != null) {\n+      link.setHref(iri);\n+    } else {\n+      link = feed.addLink(iri, \"next-archive\");\n+    }\n+    return link;\n+  }\n+  \n+  public static Link setPreviousArchive(Feed feed, String iri) throws IRISyntaxException {\n+    Link link = feed.getLink(\"prev-archive\");\n+    if (link == null) { // try the full IANA URI version\n+      link = feed.getLink(Link.IANA_BASE + \"prev-archive\");\n+    }\n+    if (link != null) {\n+      link.setHref(iri);\n+    } else {\n+      link = feed.addLink(iri, \"prev-archive\");\n+    }\n+    return link;\n+  }\n+  \n+  public static Link setCurrent(Feed feed, String iri) throws IRISyntaxException {\n+    Link link = feed.getLink(\"current\");\n+    if (link == null) { // try the full IANA URI version\n+      link = feed.getLink(Link.IANA_BASE + \"current\");\n+    }\n+    if (link != null) {\n+      link.setHref(iri);\n+    } else {\n+      link = feed.addLink(iri, \"current\");\n+    }\n+    return link;\n+  }\n+  \n+  public static IRI getNext(Feed feed) throws IRISyntaxException {\n+    Link link = feed.getLink(\"next\");\n+    return (link != null) ? link.getResolvedHref() : null;\n+  }\n+  \n+  public static IRI getPrevious(Feed feed) throws IRISyntaxException {\n+    Link link = feed.getLink(\"previous\");\n+    return (link != null) ? link.getResolvedHref() : null;\n+  }\n+  \n+  public static IRI getFirst(Feed feed) throws IRISyntaxException {\n+    Link link = feed.getLink(\"first\");\n+    return (link != null) ? link.getResolvedHref() : null;\n+  }\n+  \n+  public static IRI getLast(Feed feed) throws IRISyntaxException {\n+    Link link = feed.getLink(\"last\");\n+    return (link != null) ? link.getResolvedHref() : null;\n+  }\n+  \n+  public static IRI getPreviousArchive(Feed feed) throws IRISyntaxException {\n+    Link link = feed.getLink(\"prev-archive\");\n+    if (link == null) { // try the full IANA URI version\n+      link = feed.getLink(Link.IANA_BASE + \"prev-archive\");\n+    }\n+    return (link != null) ? link.getResolvedHref() : null;\n+  }\n+  \n+  public static IRI getNextArchive(Feed feed) throws IRISyntaxException {\n+    Link link = feed.getLink(\"next-archive\");\n+    if (link == null) { // try the full IANA URI version\n+      link = feed.getLink(Link.IANA_BASE + \"next-archive\");\n+    }\n+    return (link != null) ? link.getResolvedHref() : null;\n+  }\n+  \n+  public static IRI getCurrent(Feed feed) throws IRISyntaxException {\n+    Link link = feed.getLink(\"current\");\n+    if (link == null) { // try the full IANA URI version\n+      link = feed.getLink(Link.IANA_BASE + \"current\");\n+    }\n+    return (link != null) ? link.getResolvedHref() : null;\n+  }\n+}\n\nAdded: incubator/abdera/java/trunk/extensions/src/test/java/org/apache/abdera/test/ext/history/HistoryTest.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/extensions/src/test/java/org/apache/abdera/test/ext/history/HistoryTest.java?view=auto&rev=452996\n==============================================================================\n--- incubator/abdera/java/trunk/extensions/src/test/java/org/apache/abdera/test/ext/history/HistoryTest.java (added)\n+++ incubator/abdera/java/trunk/extensions/src/test/java/org/apache/abdera/test/ext/history/HistoryTest.java Wed Oct  4 13:00:39 2006\n@@ -0,0 +1,73 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  The ASF licenses this file to You\n+* under the Apache License, Version 2.0 (the \"License\"); you may not\n+* use this file except in compliance with the License.\n+* You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.  For additional information regarding\n+* copyright in this work, please see the NOTICE file in the top level\n+* directory of this distribution.\n+*/\n+package org.apache.abdera.test.ext.history;\n+\n+import org.apache.abdera.Abdera;\n+import org.apache.abdera.ext.history.FeedHistoryHelper;\n+import org.apache.abdera.model.Feed;\n+\n+import junit.framework.TestCase;\n+\n+public class HistoryTest extends TestCase {\n+\n+  public static void testHistory() throws Exception {\n+    \n+    Abdera abdera = new Abdera();\n+    \n+    Feed feed = abdera.getFactory().newFeed();\n+\n+    FeedHistoryHelper.setComplete(feed, true);\n+    FeedHistoryHelper.setArchive(feed, true);\n+\n+    FeedHistoryHelper.setNext(feed, \"http://example.org/foo\");\n+    FeedHistoryHelper.setNext(feed, \"http://example.org/bar\");\n+    \n+    FeedHistoryHelper.setPrevious(feed, \"http://example.org/foo\");\n+    FeedHistoryHelper.setPrevious(feed, \"http://example.org/bar\");\n+    \n+    FeedHistoryHelper.setLast(feed, \"http://example.org/foo\");\n+    FeedHistoryHelper.setLast(feed, \"http://example.org/bar\");\n+\n+    FeedHistoryHelper.setFirst(feed, \"http://example.org/foo\");\n+    FeedHistoryHelper.setFirst(feed, \"http://example.org/bar\");\n+\n+    FeedHistoryHelper.setPreviousArchive(feed, \"http://example.org/foo\");\n+    FeedHistoryHelper.setPreviousArchive(feed, \"http://example.org/bar\");\n+    \n+    FeedHistoryHelper.setNextArchive(feed, \"http://example.org/foo\");\n+    FeedHistoryHelper.setNextArchive(feed, \"http://example.org/bar\");\n+\n+    FeedHistoryHelper.setCurrent(feed, \"http://example.org/foo\");\n+    FeedHistoryHelper.setCurrent(feed, \"http://example.org/bar\");\n+    \n+    assertTrue(FeedHistoryHelper.isPaged(feed));\n+    assertTrue(FeedHistoryHelper.isComplete(feed));\n+    assertTrue(FeedHistoryHelper.isArchive(feed));\n+    \n+    assertNotNull(FeedHistoryHelper.getNext(feed));\n+    assertNotNull(FeedHistoryHelper.getPrevious(feed));\n+    assertNotNull(FeedHistoryHelper.getLast(feed));\n+    assertNotNull(FeedHistoryHelper.getFirst(feed));\n+    assertNotNull(FeedHistoryHelper.getNextArchive(feed));\n+    assertNotNull(FeedHistoryHelper.getPreviousArchive(feed));\n+    assertNotNull(FeedHistoryHelper.getCurrent(feed));\n+    \n+    assertEquals(FeedHistoryHelper.getNext(feed).toString(),\"http://example.org/bar\");\n+  }\n+  \n+}\n\n\n", "message_to": "abdera-commits@incubator.apache.org", "message_from": "jmsnell@apache.org", "references": null, "message_uuid": "1cda6c4c5e1c11e3a468fa163e1e9c80", "list_id": "abdera-commits.incubator.apache.org", "date": "Wed, 04 Oct 2006 20:00:40 -0000", "in_reply_to": null, "message_id": "20061004200040.416EF1A981D@eris.apache.org", "subject": "svn commit: r452996 - in /incubator/abdera/java/trunk/extensions/src:\n main/java/org/apache/abdera/ext/history/\n test/java/org/apache/abdera/test/ext/history/"}
{"body": "Author: jmsnell\nDate: Thu Oct  5 13:51:10 2006\nNew Revision: 453378\n\nURL: http://svn.apache.org/viewvc?view=rev&rev=453378\nLog:\nApplying the patch provided by Ugo Cei. (http://issues.apache.org/jira/browse/ABDERA-10)\n\nThis allows us to specify whether to use chunked encoding via the request options.\n\nModified:\n    incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client/Client.java\n    incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client/RequestOptions.java\n\nModified: incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client/Client.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client/Client.java?view=diff&rev=453378&r1=453377&r2=453378\n==============================================================================\n--- incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client/Client.java (original)\n+++ incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client/Client.java Thu Oct  5 13:51:10 2006\n@@ -136,7 +136,7 @@\n     String uri, \n     Base base, \n     RequestOptions options) {\n-      return execute(\"POST\", uri, new BaseRequestEntity(base), options);\n+      return execute(\"POST\", uri, new BaseRequestEntity(base, options.isUseChunked()), options);\n   }\n     \n   public ClientResponse put(\n@@ -157,7 +157,7 @@\n       String uri, \n       Base base, \n       RequestOptions options) {\n-    return execute(\"PUT\", uri, new BaseRequestEntity(base), options);\n+    return execute(\"PUT\", uri, new BaseRequestEntity(base, options.isUseChunked()), options);\n   }\n       \n   public ClientResponse delete(\n\nModified: incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client/RequestOptions.java\nURL: http://svn.apache.org/viewvc/incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client/RequestOptions.java?view=diff&rev=453378&r1=453377&r2=453378\n==============================================================================\n--- incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client/RequestOptions.java (original)\n+++ incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client/RequestOptions.java Thu Oct  5 13:51:10 2006\n@@ -39,6 +39,7 @@\n \n   private boolean noLocalCache = false;\n   private boolean revalidateAuth = false;\n+  private boolean useChunked = true;\n   \n   private final Map<String,List<String>> headers;  \n   \n@@ -301,5 +302,19 @@\n   \n   public void setRevalidateWithAuth(boolean revalidateAuth) {\n     this.revalidateAuth= revalidateAuth;\n+  }\n+  \n+  /**\n+   * Should the request use chunked encoding?\n+   */\n+  public boolean isUseChunked() {\n+    return useChunked;\n+  }\n+  \n+  /**\n+   * Set whether the request should use chunked encoding.\n+   */\n+  public void setUseChunked(boolean useChunked) {\n+    this.useChunked = useChunked;\n   }\n }\n\n\n", "message_to": "abdera-commits@incubator.apache.org", "message_from": "jmsnell@apache.org", "references": null, "message_uuid": "1cda8ace5e1c11e3a468fa163e1e9c80", "list_id": "abdera-commits.incubator.apache.org", "date": "Thu, 05 Oct 2006 20:51:11 -0000", "in_reply_to": null, "message_id": "20061005205111.223C01A981A@eris.apache.org", "subject": "svn commit: r453378 - in\n /incubator/abdera/java/trunk/client/src/main/java/org/apache/abdera/protocol/client:\n Client.java RequestOptions.java"}
